#
# Executes commands at the start of an interactive session.
#
# Authors:
#   Sorin Ionescu <sorin.ionescu@gmail.com>
#
gdate "+s%N"
zmodload zsh/zprof

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh" # This loads nvm

# Source Prezto.
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
fi

# Customize to your needs..

# Fuzzy Completions
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# F path to completion functions
fpath=(
/usr/local/share/zsh-completions
/usr/local/share/zsh/site-functions
$fpath
/usr/local/var/homebrew/linked/zsh/share/zsh/functions
/usr/local/Cellar/zsh-completions/0.22.0/share/zsh-completions
)

# gulp
eval "$(gulp --completion=zsh)"

# Personalizations
alias rhelp=run-help
alias gi='grep -i'
alias ls='ls -G'

# iTerm2 shell integration hooks
source ~/.iterm2_shell_integration.zsh

# Node version manager
# place this after nvm initialization!
autoload -U add-zsh-hook
load-nvmrc() {
  local node_version="$(nvm version)"
  local nvmrc_path="$(nvm_find_nvmrc)"

  if [ -n "$nvmrc_path" ]; then
    local nvmrc_node_version=$(nvm version "$(cat "${nvmrc_path}")")

    if [ "$nvmrc_node_version" != "N/A" ] && [ "$nvmrc_node_version" != "$node_version" ]; then
      nvm install
    fi
  elif [ "$node_version" != "$(nvm version default)" ]; then
    echo "Reverting to nvm default version"
    nvm use default
  fi
}
add-zsh-hook chpwd load-nvmrc
load-nvmrc
gdate "+s%N"
